<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>BioalgaFrontend</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <!-- Fuente -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS (CDN, sin SRI para evitar bloqueo) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <app-root></app-root>

    <!-- ===== FAB Customize flotante ===== -->
    <button
      id="customizeFab"
      class="customize-fab"
      aria-controls="customizerPanel"
      aria-expanded="false"
    >
      <i class="bi bi-sliders"></i> Customize
    </button>

    <!-- Overlay -->
    <div id="customizerOverlay" class="customizer-overlay" hidden></div>

    <!-- ===== Panel lateral de personalización ===== -->
    <aside
      id="customizerPanel"
      class="customizer"
      role="dialog"
      aria-modal="true"
      aria-labelledby="czTitle"
      aria-hidden="true"
    >
      <div class="customizer-header">
        <button
          id="customizerClose"
          class="customizer-close"
          aria-label="Cerrar"
        >
          <i class="bi bi-x-lg"></i>
        </button>
        <h5 id="czTitle">Personalizador de temas</h5>
        <small
          >Personaliza el <strong>fondo general</strong> (no afecta el
          sidebar)</small
        >
      </div>

      <div class="customizer-body">
        <div class="section-title">Variación del tema (FONDO)</div>
        <div class="theme-grid" id="themeGrid">
          <!-- BLUE -->
          <button
            class="theme-tile"
            data-theme="blue"
            type="button"
            aria-label="Tema azul"
          >
            <div
              class="theme-swatch"
              style="
                background: linear-gradient(
                  180deg,
                  #1b2770 0%,
                  #0b1222 55%,
                  #060b16 100%
                );
              "
            ></div>
            <div>Azul</div>
          </button>
          <!-- DARK -->
          <button
            class="theme-tile"
            data-theme="dark"
            type="button"
            aria-label="Tema oscuro"
          >
            <div
              class="theme-swatch"
              style="
                background: linear-gradient(
                  180deg,
                  #0b1222 0%,
                  #0a0f1a 50%,
                  #070b12 100%
                );
              "
            ></div>
            <div>Oscuro</div>
          </button>
          <!-- LIGHT -->
          <button
            class="theme-tile"
            data-theme="light"
            type="button"
            aria-label="Tema claro"
          >
            <div
              class="theme-swatch"
              style="background: #ffffff; border: 1px solid #cbd5e1"
            ></div>
            <div>Claro</div>
          </button>
          <!-- TEAL -->
          <button
            class="theme-tile"
            data-theme="teal"
            type="button"
            aria-label="Tema teal"
          >
            <div
              class="theme-swatch"
              style="
                background: radial-gradient(
                  1100px 580px at 65% 8%,
                  #035a67 0%,
                  #012c33 55%,
                  #001b20 100%
                );
              "
            ></div>
            <div>Teal</div>
          </button>
        </div>
      </div>
    </aside>

    <!-- Bootstrap JS bundle (incluye Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js opcional -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

    <!-- ===== Lógica del personalizador (global) ===== -->
    <script>
      (function () {
        const fab = document.getElementById("customizeFab");
        const panel = document.getElementById("customizerPanel");
        const closeBtn = document.getElementById("customizerClose");
        const overlay = document.getElementById("customizerOverlay");
        const grid = document.getElementById("themeGrid");

        function openPanel() {
          panel.classList.add("open");
          panel.setAttribute("aria-hidden", "false");
          overlay.hidden = false;
          overlay.classList.add("show");
          fab.setAttribute("aria-expanded", "true");
        }
        function closePanel() {
          panel.classList.remove("open");
          panel.setAttribute("aria-hidden", "true");
          overlay.classList.remove("show");
          setTimeout(() => {
            overlay.hidden = true;
          }, 180);
          fab.setAttribute("aria-expanded", "false");
        }

        fab.addEventListener("click", openPanel);
        closeBtn.addEventListener("click", closePanel);
        overlay.addEventListener("click", closePanel);
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closePanel();
        });

        // ====== Aplica TEMA DE FONDO (solo html/body) y lo guarda ======
        function applyAppTheme(theme) {
          document.documentElement.setAttribute("data-app-theme", theme); // <html>
          document.body.setAttribute("data-app-theme", theme); // <body>
          try {
            localStorage.setItem("app-theme", theme);
          } catch {}
          markActive(theme);
        }

        // Marca activa la tarjeta
        function markActive(theme) {
          for (const btn of grid.querySelectorAll(".theme-tile")) {
            btn.classList.toggle("active", btn.dataset.theme === theme);
          }
        }

        // Click en una tarjeta
        grid.addEventListener("click", (ev) => {
          const target = ev.target.closest(".theme-tile");
          if (!target) return;
          applyAppTheme(target.dataset.theme);
        });

        // Restaura el tema guardado al cargar
        const saved = localStorage.getItem("app-theme") || "blue";
        applyAppTheme(saved);
      })();
    </script>
  </body>
</html>
